<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Google Drive Upload</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h2>Upload File to Google Drive</h2>
  <button onclick="handleAuthClick()">Sign in with Google</button>
  <input type="file" id="fileInput">
  <button onclick="uploadFile()">Upload</button>

  <script>
    const CLIENT_ID = '347410332768-elvor0mtrlmbttpr0stqrfduq448i7sl.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyA4vk0smXEXMBDQ55dlBVp3JpBkNDRRzsw';
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';
    const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'];

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES,
      }).then(() => {
        console.log('GAPI client initialized.');
      }).catch(error => {
        console.error('Error during initClient:', error);
        alert('Failed to initialize Google API client.');
      });
    }

    function handleAuthClick() {
      const authInstance = gapi.auth2.getAuthInstance();
      if (authInstance.isSignedIn.get()) {
        alert('Already signed in');
      } else {
        authInstance.signIn().then(() => {
          alert('Signed in!');
        }).catch(err => {
          console.error('Sign-in error:', err);
          alert('Failed to sign in.');
        });
      }
    }

    function uploadFile() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) {
        alert('Please select a file.');
        return;
      }

      const metadata = {
        name: file.name,
        mimeType: file.type,
      };

      const accessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;

      const form = new FormData();
      form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
      form.append('file', file);

      fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
        method: 'POST',
        headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
        body: form,
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Upload failed');
          }
          return response.json();
        })
        .then(data => {
          alert('File uploaded successfully! File ID: ' + data.id);
          console.log(data);
        })
        .catch(error => {
          console.error('Upload error:', error);
          alert('Error uploading file: ' + error.message);
        });
    }

    // Load GAPI on window load
    window.onload = handleClientLoad;
  </script>
</body>
</html>